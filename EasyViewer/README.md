# Mattermost 聊天記錄查看器 (EasyViewer)

這是一個簡易的 Web 介面，用於查看使用 MattermostDll 下載的聊天記錄。
![MattermostWebview](img/index.png)
![MattermostWebview](img/login.png)

## 功能特色

### 核心功能
- 📅 **日期選擇**: 選擇不同日期的下載記錄
- 💬 **頻道瀏覽**: 瀏覽所有可用的頻道
- 🔍 **智慧搜尋**: 支援精確關鍵字搜尋和多關鍵字組合搜尋
- 🌐 **跨頻道搜尋**: 全域搜尋功能，可同時搜尋所有頻道內容
- 📎 **附件下載**: 直接下載聊天中的附件檔案
- 🕒 **時間排序**: 按時間順序顯示聊天記錄
- 💬 **回覆顯示**: 清楚標示回覆訊息

### 搜尋功能
- 🎯 **精確搜尋**: 支援完整單詞匹配和邊界檢測
- 🔤 **多關鍵字**: 支援空格分隔的多個關鍵字同時搜尋
- 🏷️ **結果標註**: 搜尋結果會高亮顯示匹配的關鍵字
- 📊 **搜尋統計**: 顯示搜尋結果數量和範圍資訊
- 🔄 **即時搜尋**: 輸入時即時更新搜尋結果
- 🌍 **搜尋範圍**: 可選擇搜尋當前頻道或所有頻道
- 🏆 **頻道標籤**: 全域搜尋結果會顯示來源頻道

### 安全功能
- 🔐 **密碼保護**: 支援應用程式訪問密碼設定
- 🛡️ **安全配置**: 可自定義安全設定和密碼策略
- 🔒 **會話管理**: 安全的登入會話控制

### 介面設計
- 🎨 **現代化介面**: 採用漸層設計和玻璃擬態效果
- ✨ **動畫效果**: 流暢的載入動畫和訊息淡入效果
- 🌈 **視覺優化**: 圓角設計、陰影效果和現代色彩搭配
- 📱 **響應式設計**: 完美適配各種螢幕尺寸

### 效能優化
- ⚡ **記憶體管理**: 智慧記憶體使用和自動清理
- 📈 **載入限制**: 防止過度載入造成系統負擔
- 🔄 **背景載入**: 全域搜尋資料背景預載入
- 📊 **效能監控**: 記憶體使用量監控和警告

## 安裝與使用

### 1. 安裝依賴套件

```bash
cd EasyViewer
pip install -r requirements.txt
```

### 2. 啟動應用程式

```bash
python app.py
```

### 3. 開啟瀏覽器

在瀏覽器中開啟 `http://localhost:5003`

## 使用說明

### 基本操作

1. **選擇日期**: 在左側邊欄選擇要查看的下載日期
2. **選擇頻道**: 點擊頻道名稱來載入聊天記錄
3. **瀏覽訊息**: 在右側主要區域查看聊天記錄
4. **搜尋訊息**: 使用搜尋框來尋找特定訊息或使用者
5. **下載附件**: 點擊附件連結來下載檔案

### 搜尋功能詳解

#### 搜尋範圍選擇
- **當前頻道**: 僅搜尋目前選中的頻道內容
- **所有頻道**: 搜尋當前日期下所有頻道的內容

#### 搜尋技巧
- **精確搜尋**: 輸入完整單詞進行精確匹配
- **多關鍵字**: 使用空格分隔多個關鍵字，系統會尋找包含所有關鍵字的訊息
- **即時結果**: 輸入時會即時顯示搜尋結果數量
- **結果高亮**: 匹配的關鍵字會以黃色背景標註
- **頻道標籤**: 全域搜尋結果會顯示藍色頻道標籤

#### 搜尋範例
- `會議` - 搜尋包含「會議」的訊息
- `專案 進度` - 搜尋同時包含「專案」和「進度」的訊息
- `@username` - 搜尋特定使用者的訊息

### 安全設定

#### 密碼保護
- 首次啟動時可設定訪問密碼
- 支援自定義密碼強度要求
- 安全會話管理和自動登出

#### 配置檔案
- 密碼設定儲存在 `security_config.md`
- 可自定義安全策略和訪問控制
- 支援密碼重設和更新

### 介面說明

#### 左側邊欄
- **現代化標題**: 採用漸層背景和圓角設計的應用程式標題
- **日期選擇器**: 具有現代化樣式的下拉選單選擇日期
- **頻道列表**: 採用卡片式設計，具有懸停效果的頻道清單
- **搜尋框**: 具有圖示和現代化樣式的搜尋輸入框

#### 主要區域
- **歡迎頁面**: 具有漸層背景和使用說明的歡迎介面
- **頻道資訊**: 採用卡片式設計顯示頻道名稱、匯出時間和總訊息數
- **聊天記錄**: 具有淡入動畫效果的訊息顯示
- **訊息卡片**: 採用圓角設計和陰影效果的訊息容器
- **載入動畫**: 流暢的載入指示器和動畫效果
- **附件顯示**: 現代化的附件卡片設計，支援圖片預覽

### 訊息類型

- **一般訊息**: 白色背景的標準訊息
- **回覆訊息**: 左側有黃色邊框的回覆訊息
- **附件訊息**: 包含可下載檔案的訊息
- **程式碼區塊**: 以等寬字體顯示的程式碼

### 附件處理

- ✅ **存在的附件**: 顯示為藍色可點擊連結
- ❌ **遺失的附件**: 顯示為紅色警告標籤
- 📁 **自動重命名**: 系統會自動處理重複檔名的附件

## 技術規格

### 後端技術
- **Flask**: Python Web 框架
- **JSON**: 資料格式處理
- **Path**: 檔案路徑管理

### 前端技術
- **Bootstrap 5**: UI 框架
- **Font Awesome**: 圖示庫
- **jQuery**: JavaScript 函式庫
- **CSS3**: 現代化樣式設計
  - CSS 變數系統
  - 漸層背景效果
  - 玻璃擬態 (Glassmorphism) 設計
  - CSS 動畫和過渡效果
  - 自定義滾動條樣式
- **響應式設計**: 支援各種螢幕尺寸
- **現代化 UI**: 圓角設計、陰影效果、懸停動畫

### 資料結構

應用程式預期的資料夾結構：
```
results/
└── YYYYMMDD/          # 日期資料夾
    └── 頻道名稱/
        ├── 頻道名稱.json   # 聊天記錄
        ├── 001_檔案.pdf    # 附件檔案
        └── 002_code.txt    # 程式碼檔案
```

## 故障排除

### 常見問題

1. **找不到聊天記錄**
   - 確認 `results` 資料夾位於 `EasyViewer` 的上一層目錄
   - 檢查日期資料夾格式是否為 8 位數字 (YYYYMMDD)

2. **附件無法下載**
   - 確認附件檔案確實存在於頻道資料夾中
   - 檢查檔案權限是否正確

3. **頁面載入緩慢**
   - 大型聊天記錄可能需要較長載入時間
   - 考慮使用搜尋功能來縮小範圍
   - 全域搜尋會在背景載入，首次使用可能較慢

4. **搜尋無結果**
   - 搜尋功能區分大小寫
   - 確認關鍵字拼寫正確
   - 檢查搜尋範圍設定（當前頻道 vs 所有頻道）

5. **全域搜尋載入中**
   - 全域搜尋需要載入所有頻道資料，請稍候
   - 系統會顯示載入進度和狀態
   - 大量資料時會自動限制載入數量以保護效能

6. **密碼相關問題**
   - 忘記密碼時請檢查 `security_config.md` 檔案
   - 密碼設定問題請參考安全配置說明
   - 會話過期時需要重新登入

7. **記憶體使用過高**
   - 系統會自動監控記憶體使用量
   - 切換日期時會自動清理記憶體
   - 如遇效能問題，請重新整理頁面

### 效能優化

#### 記憶體管理
- 智慧記憶體監控和自動清理機制
- 切換日期時自動釋放舊資料
- 記憶體使用量達到 100MB 時會發出警告
- 支援瀏覽器垃圾回收機制

#### 載入優化
- 全域搜尋資料背景預載入，不影響正常使用
- 限制同時載入的頻道數量（最多 20 個）
- 每個頻道最多載入 1000 條訊息
- 載入過程採用延遲機制，避免系統負擔

#### 搜尋優化
- 搜尋功能在前端執行，響應速度快
- 精確關鍵字匹配算法，提高搜尋準確度
- 即時搜尋結果更新，無需等待
- 搜尋索引快取機制，提升重複搜尋效能

#### 其他優化
- 應用程式會自動處理大型 JSON 檔案
- 附件採用串流下載，節省記憶體
- 漸進式載入和顯示，改善使用者體驗

## 開發資訊

- **版本**: 3.0.0 (智慧搜尋與安全強化版本)
- **相容性**: Python 3.7+
- **設計特色**: 現代化 UI/UX 設計 + 智慧搜尋功能
- **主要更新內容**:
  - 🔍 **智慧搜尋系統**: 精確關鍵字匹配、多關鍵字支援
  - 🌐 **跨頻道搜尋**: 全域搜尋功能，支援所有頻道同時搜尋
  - 🏷️ **搜尋結果標註**: 關鍵字高亮顯示和頻道標籤
  - 🔐 **安全功能**: 密碼保護和安全配置管理
  - ⚡ **效能優化**: 記憶體管理、載入限制、背景預載入
  - 📊 **搜尋統計**: 即時搜尋結果統計和範圍顯示
  - 🎯 **使用者體驗**: 改進的搜尋介面和互動設計
- **技術改進**:
  - 前端搜尋索引系統
  - 記憶體監控和自動清理
  - 非同步資料載入機制
  - 安全會話管理
- **授權**: 與主專案相同
- **維護**: 與 MattermostDl 專案一同維護